import _0x1a2b from 'express';import _0x3c4d from 'fs';import _0x5e6f from 'pino';import {makeWASocket as _0x7g8h,useMultiFileAuthState as _0x9i1j,makeCacheableSignalKeyStore as _0x4m5n,Browsers as _0x6o7p,jidNormalizedUser as _0x8q9r,fetchLatestBaileysVersion as _0x1s2t,delay as _0x2k3l} from '@whiskeysockets/baileys';import _0x3m4n from 'qrcode';const router=_0x1a2b.Router();function removeFile(_0x2a1b){try{if(!_0x3c4d.existsSync(_0x2a1b))return![];_0x3c4d.rmSync(_0x2a1b,{'recursive':!![],'force':!![]});return!![];}catch(_0x5d4e){console.error('Error\x20removing\x20file:',_0x5d4e);return![];}}router.get('/',async(_0x3f2g,_0x1h9j)=>{const _0x4k5l=Date.now().toString()+Math.random().toString(0x24).substr(0x2,0x9);const _0x2m3n='./qr_sessions/session_'+_0x4k5l;if(!_0x3c4d.existsSync('./qr_sessions')){_0x3c4d.mkdirSync('./qr_sessions',{'recursive':!![]});}async function _0x5p6q(){if(!_0x3c4d.existsSync(_0x2m3n))_0x3c4d.mkdirSync(_0x2m3n,{'recursive':!![]});const{state:_0x7r8s,saveCreds:_0x9t0u}=await _0x9i1j(_0x2m3n);try{const{version:_0x1v2w}=await _0x1s2t();let _0x3x4y=![];let _0x5z1a=![];const _0x3b2c=async(_0x1d2e)=>{if(_0x3x4y||_0x5z1a)return;_0x3x4y=!![];try{const _0x7j8k=await _0x3m4n.toDataURL(_0x1d2e,{'errorCorrectionLevel':'M','type':'image/png','quality':0.92,'margin':0x1,'color':{'dark':'#000000','light':'#FFFFFF'}});if(!_0x5z1a){_0x5z1a=!![];await _0x1h9j.send({'qr':_0x7j8k,'message':'QR\x20Code\x20Generated!','instructions':['1.\x20Open\x20WhatsApp','2.\x20Go\x20to\x20Linked\x20Devices','3.\x20Scan\x20QR\x20Code']});}}catch(_0x9l0m){if(!_0x5z1a){_0x5z1a=!![];_0x1h9j.status(0x1f4).send({'code':'Failed'});}}};const _0x1n2o={'version':_0x1v2w,'logger':_0x5e6f({'level':'silent'}),'browser':_0x6o7p.windows('Chrome'),'auth':{'creds':_0x7r8s.creds,'keys':_0x4m5n(_0x7r8s.keys,_0x5e6f({'level':'fatal'}))},'connectTimeoutMs':0xea60};let _0x3p4q=_0x7g8h(_0x1n2o);const _0x5r6s=async(_0x7t8u)=>{const{connection:_0x2w1x,qr:_0x4y3z}=_0x7t8u;if(_0x4y3z&&!_0x3x4y)await _0x3b2c(_0x4y3z);if(_0x2w1x==='open'){try{const _0x8k9l=_0x2m3n+'/creds.json';const _0x1m2n=_0x8q9r(_0x3p4q.authState.creds.me.id);await _0x3p4q.sendMessage(_0x1m2n,{'document':_0x3c4d.readFileSync(_0x8k9l),'mimetype':'application/json','fileName':'creds.json'});}catch(_0x3o4p){}setTimeout(()=>{removeFile(_0x2m3n);},0x3a98);}if(_0x2w1x==='close'){_0x5p6q();}};_0x3p4q.ev.on('connection.update',_0x5r6s);_0x3p4q.ev.on('creds.update',_0x9t0u);setTimeout(()=>{if(!_0x5z1a){_0x5z1a=!![];_0x1h9j.status(0x198).send({'code':'Timeout'});removeFile(_0x2m3n);}},0x7530);}catch(_0x5s6t){removeFile(_0x2m3n);}}_0x5p6q();});export default router;
